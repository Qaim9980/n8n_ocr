{
  "name": "daily github trending",
  "nodes": [
    {
      "parameters": {
        "operation": "getAll",
        "tableId": "pushed_repos",
        "limit": 100,
        "matchType": "allFilters",
        "filters": {
          "conditions": [
            {
              "keyName": "pushed_at",
              "condition": "gte",
              "keyValue": "={{ new Date(new Date().getTime() - 30 * 24 * 3600_000).toISOString() }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        360,
        100
      ],
      "id": "55ce7f21-f5bd-4d45-a3e7-13425ee357ef",
      "name": "Last 30d push history",
      "credentials": {
        "supabaseApi": {
          "id": "UrRwU1KSunTAaOc9",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "operation": "getAll",
        "tableId": "trending_repos",
        "limit": 500,
        "matchType": "allFilters",
        "filters": {
          "conditions": [
            {
              "keyName": "date",
              "condition": "gte",
              "keyValue": "={{ new Date(new Date().getTime() - 24 * 3600_000).toISOString() }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        580,
        100
      ],
      "id": "a12dfb96-7b1f-4ae8-9e8d-e35d90e0dc5d",
      "name": "Last 24h trending repo",
      "executeOnce": true,
      "credentials": {
        "supabaseApi": {
          "id": "UrRwU1KSunTAaOc9",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "language": "python",
        "pythonCode": "from collections import defaultdict\n\n\ndef calculate_score(repo):\n    \"\"\"Calculate a score for a repository based on its rank,\n    appearance count, today's stars, and total stars.\n    \"\"\"\n    weight_rank = 0.4\n    weight_appearance = 0.3\n    weight_today_stars = 0.2\n    weight_stars = 0.1\n\n    normalized_rank_score = (15 - repo['avg_rank']) / 15 if repo['avg_rank'] is not None else 0\n    normalized_appearance_score = repo['appearance_count'] / 24.0 # 24 hour\n\n    max_stars_estimate = 100000\n    max_today_stars_estimate = 5000\n    normalized_stars_score = (repo['stars'] or 0) / max_stars_estimate\n    normalized_today_stars_score = (repo['today_stars'] or 0) / max_today_stars_estimate\n\n    score = (normalized_rank_score * weight_rank +\n             normalized_appearance_score * weight_appearance +\n             normalized_today_stars_score * weight_today_stars +\n             normalized_stars_score * weight_stars)\n    return score\n\n\naggregated_repos = defaultdict(lambda: {\n    'description': '',\n    'language': '',\n    'stars': 0,\n    'forks': 0,\n    'today_stars': 0,\n    'appearance_count': 0,\n    'rank_sum': 0,\n})\n\nfor item in _input.all():\n    repo = item.json\n    repo_name = repo['name']\n\n    aggregated_repos[repo_name]['description'] = repo.get('description', '')\n    aggregated_repos[repo_name]['language'] = repo.get('language', '')\n  \n    aggregated_repos[repo_name]['stars'] = max(aggregated_repos[repo_name]['stars'], repo['stars'])\n    aggregated_repos[repo_name]['forks'] = max(aggregated_repos[repo_name]['forks'], repo['forks'])\n    aggregated_repos[repo_name]['today_stars'] = max(aggregated_repos[repo_name]['today_stars'], repo['today_stars'])\n\n    aggregated_repos[repo_name]['appearance_count'] += 1\n    aggregated_repos[repo_name]['rank_sum'] += repo['rank']\n\n# calculate average rank and prepare final list\ncandidate_repos = []\nfor name, repo in aggregated_repos.items():\n    repo['avg_rank'] = repo['rank_sum'] / repo['appearance_count']\n    repo['name'] = name\n    repo['score'] = calculate_score(repo)\n    del repo['rank_sum']\n    candidate_repos.append(repo)\n\ncandidate_repos.sort(key=lambda x: x['score'], reverse=True)\n\ncandidate_repo_count = _('settings').first().json.candidate_repo_count\nreturn candidate_repos[:candidate_repo_count]"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1020,
        100
      ],
      "id": "c9ce8b9f-5127-476c-9dd8-3ec46c5950cb",
      "name": "Calc top repos",
      "executeOnce": true
    },
    {
      "parameters": {
        "language": "python",
        "pythonCode": "# Loop over input items and add a new field called 'myNewField' to the JSON of each one\ntrending_repos = _('Last 24h trending repo').all()\npushed_repos = [item.json['name']  for item in _('Last 30d push history').all()]\nprint(\"pushed_repos: \", pushed_repos)\n\nreturn [\n  item.json for item in trending_repos if item.json['name'] not in pushed_repos\n]\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        800,
        100
      ],
      "id": "49bf2223-34f2-4d58-832d-32597b68173b",
      "name": "Filter out pushed repos",
      "executeOnce": true
    },
    {
      "parameters": {
        "mode": "raw",
        "jsonOutput": "{\n  \"candidate_repo_count\": 3\n}\n",
        "includeOtherFields": true,
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        140,
        100
      ],
      "id": "4ace194d-7848-4566-a125-1fd5d26126a4",
      "name": "settings",
      "notesInFlow": true,
      "notes": "candidate_repo_count=3"
    },
    {
      "parameters": {
        "fromEmail": "no-reply@tomo.dev",
        "toEmail": "xiaoliang.zero@gmail.com",
        "subject": "=GitHub Daily Trending #{{ (new Date()).toISOString().split('T')[0] }}",
        "html": "={{ $json.html }}",
        "options": {}
      },
      "type": "n8n-nodes-base.emailSend",
      "typeVersion": 2.1,
      "position": [
        1240,
        360
      ],
      "id": "a4d0c47b-6a20-46b7-9637-5cf824d8f3d9",
      "name": "Send Email",
      "webhookId": "4a0138c3-08ec-485f-a434-7851256de184",
      "credentials": {
        "smtp": {
          "id": "pSeeNg9Iz9zlfEqN",
          "name": "SMTP (no-reply@tomo.dev)"
        }
      }
    },
    {
      "parameters": {
        "mode": "markdownToHtml",
        "markdown": "={{ $json.content }}",
        "destinationKey": "html",
        "options": {}
      },
      "type": "n8n-nodes-base.markdown",
      "typeVersion": 1,
      "position": [
        1020,
        360
      ],
      "id": "d2f1f30f-1274-407e-b1ac-be01c941a4ff",
      "name": "Markdown"
    },
    {
      "parameters": {
        "url": "=https://api.github.com/repos/{{ $json.name }}/readme",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "githubApi",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Accept",
              "value": "application/vnd.github.raw+json"
            },
            {
              "name": "X-GitHub-Api-Version",
              "value": "2022-11-28"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1240,
        100
      ],
      "id": "01f07111-5e10-49f8-baaa-2156f5125b69",
      "name": "Github Repo README",
      "credentials": {
        "githubApi": {
          "id": "BPdPsY19zEdpZgPO",
          "name": "GitHub account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Loop over input items and add a new field called 'myNewField' to the JSON of each one\n\nreturn {\n  \"content\": $input.all().map(item => item.json.text).join('\\n\\n')\n}"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        320,
        360
      ],
      "id": "46cb0dfd-5748-43d6-8a76-ab87c65d07af",
      "name": "Merge Markdown"
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "triggerAtHour": 8,
              "triggerAtMinute": 45
            }
          ]
        }
      },
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.2,
      "position": [
        -100,
        100
      ],
      "id": "3cd27e65-dfd8-4b63-a667-9fd8d02cd708",
      "name": "Schedule Trigger"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=你是一个专业的翻译助手，专门负责将Markdown格式的中文技术博客内容翻译成流畅、准确的英文。\n\n请将以下中文Markdown博客内容完整翻译成英文，并严格遵守以下规则：\n\n1.  **保持Markdown格式完整**：所有标题（#、##等）、列表（*、-、数字列表）、代码块（```）、粗体（**）、斜体（*）、链接（[文本](链接)）、图片（![alt文本](图片链接)）、引用（>）等Markdown语法必须在翻译后的英文内容中完全保留。\n2.  **准确性**：确保翻译准确传达原文的含义，不遗漏任何关键信息。\n3.  **流畅性与自然度**：翻译后的英文应自然流畅，符合英语表达习惯，避免生硬的直译感。\n4.  **专业术语**：对于技术术语，请使用行业内通用的英文表达。\n5.  **代码块处理**：**不要翻译任何代码块（被 ``` 包裹的内容）**。保持代码原样不动。\n6.  **链接和图片**：保持所有链接URL和图片URL不变，只翻译链接的显示文本（如果有的话）和图片的alt文本。\n7.  **语气和风格**：保持原文的语气和风格（例如，专业、友好、教程性等）。\n8.  **请直接返回翻译后的内容，不要带入其他内容\n\n**以下是需要翻译的中文Markdown内容：**\n\n{{ $json.content }}",
        "batching": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chainLlm",
      "typeVersion": 1.7,
      "position": [
        520,
        800
      ],
      "id": "a7b3a2fc-d2da-4053-8bcd-e9a04c0b0d17",
      "name": "Translate to EN"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=你是一个SEO专家，为博客网站文章提供专业建议。请根据如下博客内容提供符合SEO要求的`description`描述。要求\n* 博客内容为全文，主题为每日github trending项目推荐\n* 描述需要符合SEO相关要求，该描述将用在meta中的description字段中，长度限制160字符\n* 请仅输出一份描述，且不要输出其他内容\n* 请输出中文\n\n以下为博客内容：\n\n{{ $json.content }}",
        "batching": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chainLlm",
      "typeVersion": 1.7,
      "position": [
        860,
        560
      ],
      "id": "d0985a9b-634d-417d-9e78-a012992f30f6",
      "name": "Generate Description"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=你是一个专业的GitHub项目推荐博主。你的任务是根据提供的GitHub仓库信息和README.md内容，撰写一篇吸引人的每日推送博文，以Markdown格式输出。\n\n博文应包含以下部分：\n1.  **标题**：简洁明了，能吸引读者点击。\n2.  **引言**：简要介绍今天推荐的项目，激发读者的兴趣。\n3.  **项目亮点**：从README.md和仓库信息中提炼出项目的核心价值、主要功能、解决的问题或独特之处。请尝试从技术和应用两个角度进行描述。\n4.  **技术细节/适用场景（可选）**：如果信息允许，可以简要提及项目使用的技术栈或适合的应用场景。\n5.  **如何开始/链接**：引导读者如何进一步了解或使用该项目，并提供GitHub仓库链接。\n6.  **呼吁行动**：鼓励读者探索、贡献或分享。\n\n请注意以下事项：\n* **风格**：专业、友好、引人入胜。避免过于技术化而让非开发者难以理解。\n* **长度**：每篇博文总长度控制在300-500字之间。\n* **多仓库处理**：如果提供了多个仓库，请为每个仓库分别撰写一个独立的博文条目，并最终合并为一个完整博客内容。\n* **信息提取**：优先从`README.md`中提取项目描述、功能和使用指南。从仓库信息中获取星标数、fork数、最近更新时间等元数据以增加博文的丰富性。\n* **创意和洞察**：除了直接引用信息，请尝试对项目进行简要评价或提出你的看法，以增加博文的深度。\n\n格式要求：\n* 仅输出文章内容结果，不要加其他信息\n* 不需要重度的开场白等，如“大家好”等内容\n* 标题使用二级标签\n* 标题使用如下格式示例：`## 每日GitHub项目推荐：Vosk API - 你的离线语音识别利器！`\n\n以下为Github仓库名称 `{{ $('Calc top repos').item.json.name }}`。\n仓库信息：\n```json\n{{ JSON.stringify($('Calc top repos').item.json, null, 2) }}\n```\n\n仓库原始README信息：\n```markdown\n{{ $json.data }}\n```",
        "batching": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chainLlm",
      "typeVersion": 1.7,
      "position": [
        -80,
        360
      ],
      "id": "6e4648f9-5d45-4dc8-9671-8d4e73b9d0c5",
      "name": "Github Repo Summarize"
    },
    {
      "parameters": {
        "tableId": "pushed_repos",
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "name",
              "fieldValue": "={{ $('Calc top repos').item.json.name }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        220,
        620
      ],
      "id": "dcb6c5a3-b4a8-4f3e-b424-ea45f06c15bd",
      "name": "Save posted repos",
      "credentials": {
        "supabaseApi": {
          "id": "UrRwU1KSunTAaOc9",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "resource": "file",
        "owner": {
          "__rl": true,
          "value": "tomowang",
          "mode": "name"
        },
        "repository": {
          "__rl": true,
          "value": "tomo.dev",
          "mode": "name"
        },
        "filePath": "=content/aigc/github-daily-trending-{{ $today.format('yyyy-MM') }}/github-daily-trending-{{ $today.format('yyyy-MM-dd') }}.en.md",
        "fileContent": "=---\ntitle: \"Github Daily Trending {{ $today.format('yyyy-MM-dd')}}\"\ndescription: >\n  {{ $json.text }}\ndate: {{ $today.format('yyyy-MM-dd')}}\nisCJKLanguage: false\ndraft: false\ntags: [\"aigc\"]\n---\n\n> This article is automatically generated by n8n & AIGC workflow, please be careful to identify\n\n{{ $('Translate to EN').item.json.text }}",
        "commitMessage": "=aigc(n8n): github daily trending {{ $today.format('yyyy-MM-dd') }} en"
      },
      "type": "n8n-nodes-base.github",
      "typeVersion": 1.1,
      "position": [
        1240,
        800
      ],
      "id": "d3e56d7b-8761-4310-b7c7-fd00ce22b8c3",
      "name": "Create EN file",
      "webhookId": "9be5f369-955a-42b1-8649-05fc68774363",
      "credentials": {
        "githubApi": {
          "id": "ygxyCt9OZKu1EQik",
          "name": "GitHub Write Permission"
        }
      }
    },
    {
      "parameters": {
        "resource": "file",
        "owner": {
          "__rl": true,
          "value": "tomowang",
          "mode": "name"
        },
        "repository": {
          "__rl": true,
          "value": "tomo.dev",
          "mode": "name"
        },
        "filePath": "=content/aigc/github-daily-trending-{{ $today.format('yyyy-MM') }}/github-daily-trending-{{ $today.format('yyyy-MM-dd') }}.md",
        "fileContent": "=---\ntitle: \"Github Daily Trending {{ $today.format('yyyy-MM-dd')}}\"\ndescription: >\n  {{ $json.text }}\ndate: {{ $today.format('yyyy-MM-dd')}}\nisCJKLanguage: true\ndraft: false\ntags: [\"aigc\"]\n---\n\n> 该文章由n8n & AIGC工作流自动生成，请注意甄别\n\n{{ $('Merge Markdown').item.json.content }}",
        "commitMessage": "=aigc(n8n): github daily trending {{ $today.format('yyyy-MM-dd') }}"
      },
      "type": "n8n-nodes-base.github",
      "typeVersion": 1.1,
      "position": [
        1240,
        560
      ],
      "id": "1b4f518a-9a48-4ecf-aac0-e00a1d95e364",
      "name": "Create file",
      "webhookId": "9be5f369-955a-42b1-8649-05fc68774363",
      "credentials": {
        "githubApi": {
          "id": "ygxyCt9OZKu1EQik",
          "name": "GitHub Write Permission"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=你是一个SEO专家，为博客网站文章提供专业建议。请根据如下博客内容提供符合SEO要求的`description`描述。要求\n* 博客内容为全文，主题为每日github trending项目推荐\n* 描述需要符合SEO相关要求，该描述将用在meta中的description字段中\n* 请仅输出一份描述，且不要输出其他内容\n* 请以英文输出\n\n以下为博客内容：\n\n{{ $json.text }}",
        "batching": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chainLlm",
      "typeVersion": 1.7,
      "position": [
        860,
        800
      ],
      "id": "488de9b5-4e8f-4550-b23f-f2186890c9cc",
      "name": "Generate Description EN"
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.5-flash-preview-05-20",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        -60,
        940
      ],
      "id": "9628ccc4-bbbd-498e-bef2-1704939f426b",
      "name": "Google Gemini Chat Model",
      "notesInFlow": true,
      "credentials": {
        "googlePalmApi": {
          "id": "ITv27hwZHdVTG9kZ",
          "name": "Google Gemini(PaLM) Api account"
        }
      },
      "notes": "gemini 2.5 flash preview"
    }
  ],
  "pinData": {},
  "connections": {
    "Last 24h trending repo": {
      "main": [
        [
          {
            "node": "Filter out pushed repos",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Last 30d push history": {
      "main": [
        [
          {
            "node": "Last 24h trending repo",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Calc top repos": {
      "main": [
        [
          {
            "node": "Github Repo README",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Filter out pushed repos": {
      "main": [
        [
          {
            "node": "Calc top repos",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "settings": {
      "main": [
        [
          {
            "node": "Last 30d push history",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Markdown": {
      "main": [
        [
          {
            "node": "Send Email",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Github Repo README": {
      "main": [
        [
          {
            "node": "Github Repo Summarize",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge Markdown": {
      "main": [
        [
          {
            "node": "Markdown",
            "type": "main",
            "index": 0
          },
          {
            "node": "Translate to EN",
            "type": "main",
            "index": 0
          },
          {
            "node": "Generate Description",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Schedule Trigger": {
      "main": [
        [
          {
            "node": "settings",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Generate Description": {
      "main": [
        [
          {
            "node": "Create file",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Github Repo Summarize": {
      "main": [
        [
          {
            "node": "Merge Markdown",
            "type": "main",
            "index": 0
          },
          {
            "node": "Save posted repos",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Translate to EN": {
      "main": [
        [
          {
            "node": "Generate Description EN",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Generate Description EN": {
      "main": [
        [
          {
            "node": "Create EN file",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "Translate to EN",
            "type": "ai_languageModel",
            "index": 0
          },
          {
            "node": "Generate Description",
            "type": "ai_languageModel",
            "index": 0
          },
          {
            "node": "Github Repo Summarize",
            "type": "ai_languageModel",
            "index": 0
          },
          {
            "node": "Generate Description EN",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1",
    "timezone": "Asia/Shanghai",
    "callerPolicy": "workflowsFromSameOwner"
  },
  "versionId": "c2001378-693a-4be0-b9f3-f64dd332970f",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "e503f7c3d190fbe1708ff8f5f0fb5eea84f12e45bbc30706bb7a6b25938597b3"
  },
  "id": "3hOj2akbB53YhCWM",
  "tags": []
}
Explain